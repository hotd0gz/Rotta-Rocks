---
description: >-
  Reflective DLL injection allows an attacker to inject a DLL into a victim
  process entirely from memory rather than disk. First utilized by Stephen
  Fewer.
---

# Reflective DLL Injection

{% embed url="https://github.com/stephenfewer/ReflectiveDLLInjection/" %}



## Introduction

_<mark style="color:red;">**NOTE:**</mark>_ Most EDR's have updated their capabilities to detect this default process injection technique utilized by Stephen Fewer along with his Remote Process Execution technique using the CreateRemoteThread API.

EDR's also scan newly created Executable memory blocks in remote processes that have PAGE\_EXECUTE\_READWRITE permissions. A way around this is to parse the PE headers and distribute the sections of PE to different locations. So unlike, Stephen Fewer's default reflective loader that allocates the whole memory block to a single page with VirtualAllocEx, we will have separate sections that have different permissions.&#x20;

_<mark style="color:red;">**NOTE:**</mark>_ Also, it's important to note that changing Stephen Fewer's default reflective loader page permissions to PAGE\_EXECUTE\_READ to try to evade EDR will end in an ACCESS\_VIOLATION error. This is because there are several different sections in the PE that have their own permissions (which we cover above).

## How it works

_**Here's how reflective DLL Injection typically works:**_

1.) _**Manual Loading:**_ Instead of relying on the Windows loader to load a DLL, we manually read the DLL file (from disk or remote server), and parse it's headers and load it's code and data sections into the target processes memory.

2.) _**Relocation & Permissions:**_ The code and data sections may need to be relocated in memory to ensure they run correctly within the target processes. Additionally we need to make sure they have the proper permissions so they can be executed.

3.) _**Import Resolution:**_ We resolve the imports (dependencies) manually by traversing the import table (IAT) of the PE.

4.) _**Execution Context:**_ The code is executed within the target process by transferring control to the DLL's entry point.



## Implementation

Enought talking! Let's hack it together!

